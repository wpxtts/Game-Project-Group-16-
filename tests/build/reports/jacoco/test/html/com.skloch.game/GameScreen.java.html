<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>GameScreen.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">tests</a> &gt; <a href="index.source.html" class="el_package">com.skloch.game</a> &gt; <span class="el_source">GameScreen.java</span></div><h1>GameScreen.java</h1><pre class="source lang-java linenums">package com.skloch.game;

import com.badlogic.gdx.Gdx;
import com.badlogic.gdx.InputAdapter;
import com.badlogic.gdx.graphics.GL20;
import com.badlogic.gdx.graphics.OrthographicCamera;
import com.badlogic.gdx.graphics.Texture;
import com.badlogic.gdx.maps.MapObjects;
import com.badlogic.gdx.maps.MapProperties;
import com.badlogic.gdx.maps.tiled.TiledMapTileLayer;
import com.badlogic.gdx.maps.tiled.renderers.OrthogonalTiledMapRenderer;
import com.badlogic.gdx.math.Rectangle;
import com.badlogic.gdx.math.Vector3;
import com.badlogic.gdx.scenes.scene2d.Actor;
import com.badlogic.gdx.scenes.scene2d.Group;
import com.badlogic.gdx.scenes.scene2d.actions.Actions;
import com.badlogic.gdx.scenes.scene2d.ui.Label;
import com.badlogic.gdx.scenes.scene2d.ui.Table;
import com.badlogic.gdx.scenes.scene2d.ui.TextButton;
import com.badlogic.gdx.scenes.scene2d.utils.ChangeListener;
import com.badlogic.gdx.scenes.scene2d.ui.Image;
import com.badlogic.gdx.utils.ScreenUtils;
import com.badlogic.gdx.Screen;
import com.badlogic.gdx.scenes.scene2d.Stage;
import com.badlogic.gdx.utils.viewport.FitViewport;
import com.badlogic.gdx.utils.viewport.Viewport;
import com.badlogic.gdx.Input;
import com.badlogic.gdx.scenes.scene2d.ui.Window;
import com.badlogic.gdx.InputMultiplexer;
import com.badlogic.gdx.graphics.glutils.ShapeRenderer.ShapeType;

/**
 * Handles the majority of the game logic, rendering and user inputs of the game.
 * Responsible for rendering the player and the map, and calling events.
 */
public class GameScreen implements Screen {
    final HustleGame game;
    private OrthographicCamera camera;
<span class="fc" id="L39">    private int energy = 100;</span>
    private int hoursStudied, hoursRecreational, hoursSlept;
<span class="fc" id="L41">    private float daySeconds = 0; // Current seconds elapsed in day</span>
<span class="fc" id="L42">    private int day = 1; // What day the game is on</span>
    private Label timeLabel, dayLabel;
    public Player player;
    private Window escapeMenu;
    private Viewport viewport;
    public OrthogonalTiledMapRenderer mapRenderer;
    public Stage uiStage;
    private Label interactionLabel;
    private EventManager eventManager;
    protected InputMultiplexer inputMultiplexer;
    private Table uiTable;
    private Image energyBar;
    public DialogueBox dialogueBox;
<span class="fc" id="L55">    public final Image blackScreen = new Image(new Texture(Gdx.files.internal(&quot;../assets/Sprites/black_square.png&quot;)));;</span>
<span class="fc" id="L56">    private boolean sleeping = false;</span>



    /**
     *
     * @param game An instance of the class HustleGame containing variables that only need to be loaded or
     *             initialised once.
     * @param avatarChoice Which avatar the player has picked, 0 for the more masculine avatar, 1 for the more feminine
     */
<span class="fc" id="L66">    public GameScreen(final HustleGame game, int avatarChoice, boolean draw) {</span>
        // Important game variables
<span class="fc" id="L68">        this.game = game;</span>
<span class="fc" id="L69">        this.game.gameScreen = this;</span>
<span class="fc" id="L70">        eventManager = new EventManager(this);</span>

        // Scores
<span class="fc" id="L73">        hoursStudied = hoursRecreational = hoursSlept = 0;</span>


<span class="pc bpc" id="L76" title="1 of 2 branches missed.">        if(draw) {</span>
            // Camera and viewport settings
<span class="nc" id="L78">            camera = new OrthographicCamera();</span>
<span class="nc" id="L79">            viewport = new FitViewport(game.WIDTH, game.HEIGHT, camera);</span>
<span class="nc" id="L80">            camera.setToOrtho(false, game.WIDTH, game.HEIGHT);</span>
<span class="nc" id="L81">            game.shapeRenderer.setProjectionMatrix(camera.combined);</span>


            // Create a stage for the user interface to be on
<span class="nc" id="L85">            uiStage = new Stage(new FitViewport(game.WIDTH, game.HEIGHT));</span>
            // Add a black image over everything first
<span class="nc" id="L87">            blackScreen.setSize(viewport.getWorldWidth(), viewport.getWorldHeight());</span>
<span class="nc" id="L88">            blackScreen.addAction(Actions.alpha(0f));</span>

            // UI table to put everything in
<span class="nc" id="L91">            uiTable = new Table();</span>
<span class="nc" id="L92">            uiTable.setSize(game.WIDTH, game.HEIGHT);</span>
<span class="nc" id="L93">            uiStage.addActor(uiTable);</span>
        }


        // Create a player class
<span class="fc bfc" id="L98" title="All 2 branches covered.">        if (avatarChoice == 1) {</span>
<span class="fc" id="L99">            player = new Player(&quot;avatar1&quot;);</span>
        } else {
<span class="fc" id="L101">            player = new Player(&quot;avatar2&quot;);</span>
        }



        // USER INTERFACE

        // Create and center the yes/no box that appears when interacting with objects
//        optionDialogue = new OptionDialogue(&quot;&quot;, 400, this.game.skin, game.soundManager);
//        Window optWin = optionDialogue.getWindow();
//        optionDialogue.setPos(
//                (viewport.getWorldWidth() / 2f) - (optWin.getWidth() / 2f),
//                (viewport.getWorldHeight() / 2f) - (optWin.getHeight() / 2f) - 150
//        );
//        // Use addActor to add windows to the scene
//        uiTable.addActor(optionDialogue.getWindow());
//        optionDialogue.setVisible(false);
<span class="pc bpc" id="L118" title="1 of 2 branches missed.">        if(draw){</span>
        // Interaction label to prompt player
<span class="nc" id="L120">        interactionLabel = new Label(&quot;E - Interact&quot;, game.skin, &quot;default&quot;);</span>

        // Dialogue box
<span class="nc" id="L123">        dialogueBox = new DialogueBox(game.skin);</span>
<span class="nc" id="L124">        dialogueBox.setPos(</span>
<span class="nc" id="L125">                (viewport.getWorldWidth() - dialogueBox.getWidth()) / 2f,</span>
                15f);
<span class="nc" id="L127">        dialogueBox.hide();</span>




        // Load energy bar elements
<span class="nc" id="L133">        Group energyGroup = new Group();</span>
<span class="nc" id="L134">        energyGroup.setDebug(true);</span>
<span class="nc" id="L135">        energyBar = new Image(new Texture(Gdx.files.internal(&quot;Interface/Energy Bar/green_bar.png&quot;)));</span>
<span class="nc" id="L136">        Image energyBarOutline = new Image(new Texture(Gdx.files.internal(&quot;Interface/Energy Bar/bar_outline.png&quot;)));</span>
<span class="nc" id="L137">        energyBarOutline.setPosition(viewport.getWorldWidth()-energyBarOutline.getWidth() - 15, 15);</span>
<span class="nc" id="L138">        energyBar.setPosition(energyBarOutline.getX()+16, energyBarOutline.getY()+16);</span>
<span class="nc" id="L139">        energyGroup.addActor(energyBar);</span>
<span class="nc" id="L140">        energyGroup.addActor(energyBarOutline);</span>


        // Set initial time
<span class="nc" id="L144">        daySeconds = (8*60); // 8:00 am</span>

        // Table to display date and time
<span class="nc" id="L147">        Table timeTable = new Table();</span>
<span class="nc" id="L148">        timeTable.setFillParent(true);</span>
<span class="nc" id="L149">        timeLabel = new Label(formatTime((int) daySeconds), game.skin, &quot;time&quot;);</span>
<span class="nc" id="L150">        dayLabel = new Label(String.format(&quot;Day %d&quot;, day), game.skin, &quot;day&quot;);</span>
<span class="nc" id="L151">        timeTable.add(timeLabel).uniformX();</span>
<span class="nc" id="L152">        timeTable.row();</span>
<span class="nc" id="L153">        timeTable.add(dayLabel).uniformX().left().padTop(2);</span>
<span class="nc" id="L154">        timeTable.top().left().padLeft(10).padTop(10);</span>

        // Set the order of rendered UI elements
<span class="nc" id="L157">        uiTable.add(interactionLabel).padTop(300);</span>
<span class="nc" id="L158">        uiStage.addActor(energyGroup);</span>
<span class="nc" id="L159">        uiStage.addActor(timeTable);</span>
<span class="nc" id="L160">        uiStage.addActor(blackScreen);</span>
<span class="nc" id="L161">        uiStage.addActor(dialogueBox.getWindow());</span>
<span class="nc" id="L162">        uiStage.addActor(dialogueBox.getSelectBox().getWindow());</span>
<span class="nc" id="L163">        setupEscapeMenu(uiStage);</span>



        // Start music
<span class="nc" id="L168">        game.soundManager.playOverworldMusic();</span>


        // Create the keyboard input adapter that defines events to be called based on
        // specific button presses
<span class="nc" id="L173">        InputAdapter gameKeyBoardInput = makeInputAdapter();</span>

        // Since we need to listen to inputs from the stage and from the keyboard
        // Use an input multiplexer to listen for one inputadapter and then the other
        // inputMultiplexer needs to be established before hand since we reference it on resume() when going
        // back to this screen from the settings menu
<span class="nc" id="L179">        inputMultiplexer = new InputMultiplexer();</span>
<span class="nc" id="L180">        inputMultiplexer.addProcessor(gameKeyBoardInput);</span>
<span class="nc" id="L181">        inputMultiplexer.addProcessor(uiStage);</span>
<span class="nc" id="L182">        Gdx.input.setInputProcessor(inputMultiplexer);</span>



        // Setup map
<span class="nc" id="L187">        float unitScale = game.mapScale / game.mapSquareSize;</span>
<span class="nc" id="L188">        mapRenderer = new OrthogonalTiledMapRenderer(game.map, unitScale);</span>

        // Set the player to the middle of the map
        // Get the dimensions of the top layer
<span class="nc" id="L192">        TiledMapTileLayer layer0 = (TiledMapTileLayer) game.map.getLayers().get(0);</span>
<span class="nc" id="L193">        player.setPos(layer0.getWidth()*game.mapScale / 2f, layer0.getHeight()*game.mapScale / 2f);</span>
        // Put camera on player
<span class="nc" id="L195">        camera.position.set(player.getCentreX(), player.getCentreY(), 0);</span>

        // Give objects to player
<span class="nc bnc" id="L198" title="All 2 branches missed.">        for (int layer : game.objectLayers) {</span>
            // Get all objects on the layer
<span class="nc" id="L200">            MapObjects objects = game.map.getLayers().get(layer).getObjects();</span>

            // Loop through each, handing them to the player
<span class="nc bnc" id="L203" title="All 2 branches missed.">            for (int i = 0; i &lt; objects.getCount(); i++) {</span>
                // Get the properties of each object
<span class="nc" id="L205">                MapProperties properties = objects.get(i).getProperties();</span>
                // If this is the spawn object, move the player there and don't collide
<span class="nc bnc" id="L207" title="All 2 branches missed.">                if (properties.get(&quot;spawn&quot;) != null) {</span>
<span class="nc" id="L208">                    player.setPos(((float) properties.get(&quot;x&quot;)) *unitScale, ((float) properties.get(&quot;y&quot;))*unitScale);</span>
<span class="nc" id="L209">                    camera.position.set(player.getPosAsVec3());</span>
                } else {
                    // Make a new gameObject with these properties, passing along the scale the map is rendered
                    // at for accurate coordinates
<span class="nc" id="L213">                    player.addCollidable(new GameObject(properties, unitScale));</span>
                }
            }
        }

        // Set the player to not go outside the bounds of the map
        // Assumes the bottom left corner of the map is at 0, 0
<span class="nc" id="L220">        player.setBounds(</span>
                new Rectangle(
                        0,
                        0,
<span class="nc" id="L224">                        game.mapProperties.get(&quot;width&quot;, Integer.class) * game.mapScale,</span>
<span class="nc" id="L225">                        game.mapProperties.get(&quot;height&quot;, Integer.class) * game.mapScale</span>
                )
        );
<span class="nc" id="L228">        game.shapeRenderer.setProjectionMatrix(camera.combined);</span>

        // Display a little good morning message
<span class="nc" id="L231">        dialogueBox.show();</span>
<span class="nc" id="L232">        dialogueBox.setText(getWakeUpMessage());</span>
        }
<span class="fc" id="L234">    }</span>

    @Override
    public void show() {

<span class="nc" id="L239">    }</span>

    /**
     * Renders the player, updates sound, renders the map and updates any UI elements
     * Called every frame
     *
     * @param delta The time in seconds since the last render.
     */
    @Override
    public void render (float delta) {
        // Clear screen
<span class="nc" id="L250">        ScreenUtils.clear(0, 0, 0, 1);</span>
<span class="nc" id="L251">        Gdx.gl.glClear(GL20.GL_COLOR_BUFFER_BIT);</span>
<span class="nc" id="L252">        viewport.apply(); // Update the viewport</span>


        // Set delta to a constant value to minimise stuttering issues when moving the camera and player
        // Solution found here: https://www.reddit.com/r/libgdx/comments/5z6qaf/can_someone_help_me_understand_timestepsstuttering/
<span class="nc" id="L257">        delta = 0.016667f;</span>
        // Update sound timers
<span class="nc" id="L259">        game.soundManager.processTimers(delta);</span>


        // Load timer bar - needs fixing and drawing
        //TextureAtlas blueBar = new TextureAtlas(Gdx.files.internal(&quot;Interface/BlueTimeBar/BlueBar.atlas&quot;));
        //Skin blueSkin = new Skin(blueBar);
        //ProgressBar timeBar = new ProgressBar(0, 200, 1, false, blueSkin);
        //timeBar.act(delta);


        // Increment the time and possibly day
<span class="nc bnc" id="L270" title="All 4 branches missed.">        if (!escapeMenu.isVisible() &amp;&amp; !sleeping) {</span>
<span class="nc" id="L271">            passTime(Gdx.graphics.getDeltaTime());</span>
        }
<span class="nc" id="L273">        timeLabel.setText(formatTime((int) daySeconds));</span>

        // Freeze the player's movement for this frame if any menus are visible
<span class="nc bnc" id="L276" title="All 6 branches missed.">        if (escapeMenu.isVisible() || dialogueBox.isVisible() || sleeping) {</span>
<span class="nc" id="L277">            player.setFrozen(true);</span>
        } else {
<span class="nc" id="L279">            player.setFrozen(false);</span>
        }

<span class="nc" id="L282">        dialogueBox.scrollText(0.8f);</span>


        // Let the player move to keyboard presses if not frozen
        // Player.move() handles player collision
        // Also play a footstep sound if they are moving
<span class="nc" id="L288">        player.move(delta);</span>
<span class="nc bnc" id="L289" title="All 2 branches missed.">        if (player.isMoving()) {</span>
<span class="nc" id="L290">            game.soundManager.playFootstep();</span>
        } else {
<span class="nc" id="L292">            game.soundManager.footstepBool = false;</span>
        }


        // Update the map's render position
<span class="nc" id="L297">        mapRenderer.setView(camera);</span>
        // Draw the background layer
<span class="nc" id="L299">        mapRenderer.render(game.backgroundLayers);</span>

        // Begin the spritebatch to draw the player on the screen
<span class="nc" id="L302">        game.batch.setProjectionMatrix(camera.combined);</span>
<span class="nc" id="L303">        game.batch.begin();</span>

        // Player, draw and scale
<span class="nc" id="L306">        game.batch.draw(</span>
<span class="nc" id="L307">                player.getCurrentFrame(),</span>
                player.sprite.x, player.sprite.y,
                0, 0,
                player.sprite.width, player.sprite.height,
                1f, 1f, 1
        );

<span class="nc" id="L314">        game.batch.end();</span>

        // Render map foreground layers
<span class="nc" id="L317">        mapRenderer.render(game.foregroundLayers);</span>


        // Check if the interaction (press e to use) label needs to be drawn
<span class="nc" id="L321">        interactionLabel.setVisible(false);</span>
<span class="nc bnc" id="L322" title="All 6 branches missed.">        if (!dialogueBox.isVisible() &amp;&amp; !escapeMenu.isVisible() &amp;&amp; !sleeping) {</span>
<span class="nc bnc" id="L323" title="All 2 branches missed.">            if (player.nearObject()) {</span>
<span class="nc" id="L324">                interactionLabel.setVisible(true);</span>
                // Change text whether pressing E will interact or just read text
<span class="nc bnc" id="L326" title="All 2 branches missed.">                if (player.getClosestObject().get(&quot;event&quot;) != null) {</span>
<span class="nc" id="L327">                    interactionLabel.setText(&quot;E - Interact&quot;);</span>
<span class="nc bnc" id="L328" title="All 2 branches missed.">                } else if (player.getClosestObject().get(&quot;text&quot;) != null) {</span>
<span class="nc" id="L329">                    interactionLabel.setText(&quot;E - Read Sign&quot;);</span>
                }
            }
        }


        // Update UI elements
<span class="nc" id="L336">        uiStage.getViewport().apply();</span>
<span class="nc" id="L337">        uiStage.act(delta);</span>
<span class="nc" id="L338">        uiStage.draw();</span>


        // Focus the camera on the center of the player
        // Make it slide into place too
        // Change to camera.positon.set() to remove cool sliding
<span class="nc" id="L344">        camera.position.slerp(</span>
                new Vector3(
<span class="nc" id="L346">                        player.getCentreX(),</span>
<span class="nc" id="L347">                        player.getCentreY(),</span>
                        0
                ),
                delta*9
        );


        // Debug - Draw player hitboxes
//         drawHitboxes();

        // Debug - print the event value of the closest object to the player if there is one
//        if (player.getClosestObject() != null) {
//            System.out.println(player.getClosestObject().get(&quot;event&quot;));
//        }


<span class="nc" id="L363">        camera.update();</span>
<span class="nc" id="L364">    }</span>


    /**
     * Configures everything needed to display the escape menu window when the player presses 'escape'
     * Doesn't return anything as the variable escapeMenu is used to store the window
     * Takes a table already added to the uiStage
     *
     * @param interfaceStage The stage that the escapeMenu should be added to
     */
    public void setupEscapeMenu(Stage interfaceStage) {
        // Configures an escape menu to display when hitting 'esc'
        // Escape menu
<span class="nc" id="L377">        escapeMenu = new Window(&quot;&quot;, game.skin);</span>
<span class="nc" id="L378">        interfaceStage.addActor(escapeMenu);</span>
<span class="nc" id="L379">        escapeMenu.setModal(true);</span>

<span class="nc" id="L381">        Table escapeTable = new Table();</span>
<span class="nc" id="L382">        escapeTable.setFillParent(true);</span>

<span class="nc" id="L384">        escapeMenu.add(escapeTable);</span>

<span class="nc" id="L386">        TextButton resumeButton = new TextButton(&quot;Resume&quot;, game.skin);</span>
<span class="nc" id="L387">        TextButton settingsButton = new TextButton(&quot;Settings&quot;, game.skin);</span>
<span class="nc" id="L388">        TextButton exitButton = new TextButton(&quot;Exit&quot;, game.skin);</span>

<span class="nc" id="L390">        escapeTable.add(resumeButton).pad(60, 80, 10, 80).width(300);</span>
<span class="nc" id="L391">        escapeTable.row();</span>
<span class="nc" id="L392">        escapeTable.add(settingsButton).pad(10, 50, 10, 50).width(300);</span>
<span class="nc" id="L393">        escapeTable.row();</span>
<span class="nc" id="L394">        escapeTable.add(exitButton).pad(10, 50, 60, 50).width(300);</span>

<span class="nc" id="L396">        escapeMenu.pack();</span>

        // escapeMenu.setDebug(true);

        // Centre
<span class="nc" id="L401">        escapeMenu.setX((viewport.getWorldWidth() / 2) - (escapeMenu.getWidth() / 2));</span>
<span class="nc" id="L402">        escapeMenu.setY((viewport.getWorldHeight() / 2) - (escapeMenu.getHeight() / 2));</span>


        // Create button listeners

<span class="nc" id="L407">        resumeButton.addListener(new ChangeListener() {</span>
            @Override
            public void changed(ChangeEvent event, Actor actor) {
<span class="nc bnc" id="L410" title="All 2 branches missed.">                if (escapeMenu.isVisible()) {</span>
<span class="nc" id="L411">                    game.soundManager.playButton();</span>
<span class="nc" id="L412">                    game.soundManager.playOverworldMusic();</span>
<span class="nc" id="L413">                    escapeMenu.setVisible(false);</span>
                }
<span class="nc" id="L415">            }</span>
        });

        // SETTINGS BUTTON
        // I assign this object to a new var 'thisScreen' since the changeListener overrides 'this'
        // I wasn't sure of a better solution
<span class="nc" id="L421">        Screen thisScreen = this;</span>
<span class="nc" id="L422">        settingsButton.addListener(new ChangeListener() {</span>
            @Override
            public void changed(ChangeEvent event, Actor actor) {
<span class="nc bnc" id="L425" title="All 2 branches missed.">                if (escapeMenu.isVisible()) {</span>
<span class="nc" id="L426">                    game.soundManager.playButton();</span>
<span class="nc" id="L427">                    game.setScreen(new SettingsScreen(game, thisScreen,true));</span>
                }
<span class="nc" id="L429">            }</span>
        });

<span class="nc" id="L432">        exitButton.addListener(new ChangeListener() {</span>
            @Override
            public void changed(ChangeEvent event, Actor actor) {
<span class="nc bnc" id="L435" title="All 2 branches missed.">                if (escapeMenu.isVisible()) {</span>
<span class="nc" id="L436">                    game.soundManager.playButton();</span>
<span class="nc" id="L437">                    game.soundManager.stopOverworldMusic();</span>
<span class="nc" id="L438">                    dispose();</span>
<span class="nc" id="L439">                    game.setScreen(new MenuScreen(game,true));</span>
                }
<span class="nc" id="L441">            }</span>
        });

<span class="nc" id="L444">        escapeMenu.setVisible(false);</span>

<span class="nc" id="L446">    }</span>


    @Override
    public void resize(int width, int height) {
<span class="nc" id="L451">        uiStage.getViewport().update(width, height);</span>
<span class="nc" id="L452">        viewport.update(width, height);</span>
<span class="nc" id="L453">    }</span>

    @Override
    public void pause() {
<span class="nc" id="L457">    }</span>

    /**
     * Called when switching back to this gameScreen
     */
    @Override
    public void resume() {
        // Set the input multiplexer back to this stage
<span class="nc" id="L465">        Gdx.input.setInputProcessor(inputMultiplexer);</span>

        // I'm not sure why, but there's a small bug where exiting the settings menu doesn't make the previous
        // button on the previous screen update, so it's stuck in the 'over' configuration until the
        // user moves the mouse.
        // Uncomment the below line to bring the bug back
        // It's an issue with changing screens, and I can't figure out why it happens, but setting the mouse position
        // to exactly where it is seems to force the stage to update itself and fixes the visual issue.

<span class="nc" id="L474">        Gdx.input.setCursorPosition( Gdx.input.getX(),  Gdx.input.getY());</span>
<span class="nc" id="L475">    }</span>

    @Override
    public void hide() {
<span class="nc" id="L479">    }</span>

    /**
     * Disposes of certain elements, called when the game is closed
     */
    @Override
    public void dispose () {
<span class="nc" id="L486">        uiStage.dispose();</span>
<span class="nc" id="L487">        mapRenderer.dispose();</span>
<span class="nc" id="L488">    }</span>

    /**
     * DEBUG - Draws the player's 3 hitboxes
     * Uncomment use at the bottom of render to use
     */
    public void drawHitboxes () {
<span class="nc" id="L495">        game.shapeRenderer.setProjectionMatrix(camera.combined);</span>
<span class="nc" id="L496">        game.shapeRenderer.begin(ShapeType.Line);</span>
        // Sprite
<span class="nc" id="L498">        game.shapeRenderer.setColor(1, 0, 0, 1);</span>
<span class="nc" id="L499">        game.shapeRenderer.rect(player.sprite.x, player.sprite.y, player.sprite.width, player.sprite.height);</span>
        // Feet hitbox
<span class="nc" id="L501">        game.shapeRenderer.setColor(0, 0, 1, 1);</span>
<span class="nc" id="L502">        game.shapeRenderer.rect(player.feet.x, player.feet.y, player.feet.width, player.feet.height);</span>
        // Event hitbox
<span class="nc" id="L504">        game.shapeRenderer.setColor(0, 1, 0, 1);</span>
<span class="nc" id="L505">        game.shapeRenderer.rect(player.eventHitbox.x, player.eventHitbox.y, player.eventHitbox.width, player.eventHitbox.height);</span>
<span class="nc" id="L506">        game.shapeRenderer.end();</span>
<span class="nc" id="L507">    }</span>


    /**
     * Add a number of seconds to the time elapsed in the day
     *
     * @param delta The time in seconds to add
     */
    public void passTime(float delta) {
<span class="nc" id="L516">        daySeconds += delta;</span>
<span class="nc bnc" id="L517" title="All 2 branches missed.">        while (daySeconds &gt;= 1440) {</span>
<span class="nc" id="L518">            daySeconds -= 1440;</span>
<span class="nc" id="L519">            day += 1;</span>
<span class="nc" id="L520">            dayLabel.setText(String.format(&quot;Day %s&quot;, day));</span>
        }

<span class="nc bnc" id="L523" title="All 2 branches missed.">        if (day &gt;= 8) {</span>
<span class="nc" id="L524">            GameOver();</span>
        }
<span class="nc" id="L526">    }</span>

    /**
     * Takes a time in seconds and formats it a time in the format HH:MMam/pm
     *
     * @param seconds The seconds elapsed in a day
     * @return A formatted time on a 12 hour clock
     */
    public String formatTime(int seconds) {
        // Takes a number of seconds and converts it into a 12 hour clock time
<span class="nc" id="L536">        int hour = Math.floorDiv(seconds, 60);</span>
<span class="nc" id="L537">        String minutes = String.format(&quot;%02d&quot;, (seconds - hour * 60));</span>

        // Make 12 hour
<span class="nc bnc" id="L540" title="All 4 branches missed.">        if (hour == 24 || hour == 0) {</span>
<span class="nc" id="L541">            return String.format(&quot;12:%sam&quot;, minutes);</span>
<span class="nc bnc" id="L542" title="All 2 branches missed.">        } else if (hour == 12) {</span>
<span class="nc" id="L543">            return String.format(&quot;12:%spm&quot;, minutes);</span>
<span class="nc bnc" id="L544" title="All 2 branches missed.">        } else if (hour &gt; 12) {</span>
<span class="nc" id="L545">            return String.format(&quot;%d:%spm&quot;, hour-12, minutes);</span>
        } else {
<span class="nc" id="L547">            return String.format(&quot;%d:%sam&quot;, hour, minutes);</span>
        }
    }


    /**
     *  Generates an InputAdapter to handle game specific keyboard inputs
     *
     * @return An InputAdapter for keyboard inputs
     */
    public InputAdapter makeInputAdapter () {
<span class="nc" id="L558">        return new InputAdapter() {</span>
            @Override
            public boolean keyDown (int keycode) {
                // SHOW ESCAPE MENU CODE
<span class="nc bnc" id="L562" title="All 2 branches missed.">                if (keycode == Input.Keys.ESCAPE) {</span>
<span class="nc bnc" id="L563" title="All 2 branches missed.">                    if (escapeMenu.isVisible()) {</span>
<span class="nc" id="L564">                        game.soundManager.playButton();</span>
<span class="nc" id="L565">                        game.soundManager.playOverworldMusic();</span>
<span class="nc" id="L566">                        escapeMenu.setVisible(false);</span>
                    } else {
                        // game.soundManager.pauseOverworldMusic();
<span class="nc" id="L569">                        game.soundManager.playButton();</span>
<span class="nc" id="L570">                        escapeMenu.setVisible(true);</span>
                    }
                    // Return true to indicate the keydown event was handled
<span class="nc" id="L573">                    return true;</span>
                }

                // SHOW OPTION MENU / ACT ON OPTION MENU CODE
<span class="nc bnc" id="L577" title="All 6 branches missed.">                if (keycode == Input.Keys.E || keycode == Input.Keys.ENTER || keycode == Input.Keys.SPACE) {</span>
<span class="nc bnc" id="L578" title="All 2 branches missed.">                    if (!escapeMenu.isVisible()) {</span>
                        // If a dialogue box is visible, choose an option or advance text
<span class="nc bnc" id="L580" title="All 2 branches missed.">                        if (dialogueBox.isVisible()) {</span>
<span class="nc" id="L581">                            dialogueBox.enter(eventManager);</span>
<span class="nc" id="L582">                            game.soundManager.playButton();</span>

<span class="nc bnc" id="L584" title="All 4 branches missed.">                        } else if (player.nearObject() &amp;&amp; !sleeping) {</span>
                            // If the object has an event associated with it
<span class="nc bnc" id="L586" title="All 2 branches missed.">                            if (player.getClosestObject().get(&quot;event&quot;) != null) {</span>
                                // Show a dialogue menu asking if they want to do an interaction with the object
<span class="nc" id="L588">                                dialogueBox.show();</span>
<span class="nc" id="L589">                                dialogueBox.getSelectBox().setOptions(new String[]{&quot;Yes&quot;, &quot;No&quot;}, new String[]{(String) player.getClosestObject().get(&quot;event&quot;), &quot;exit&quot;});</span>
<span class="nc bnc" id="L590" title="All 2 branches missed.">                                if (eventManager.hasCustomObjectInteraction((String) player.getClosestObject().get(&quot;event&quot;))) {</span>
<span class="nc" id="L591">                                    dialogueBox.setText(eventManager.getObjectInteraction((String) player.getClosestObject().get(&quot;event&quot;)));</span>
                                } else {
<span class="nc" id="L593">                                    dialogueBox.setText(&quot;Interact with &quot; + player.getClosestObject().get(&quot;event&quot;) + &quot;?&quot;);</span>
                                }
<span class="nc" id="L595">                                dialogueBox.show();</span>
<span class="nc" id="L596">                                dialogueBox.getSelectBox().show();</span>
<span class="nc" id="L597">                                game.soundManager.playDialogueOpen();</span>

<span class="nc bnc" id="L599" title="All 2 branches missed.">                            } else if (player.getClosestObject().get(&quot;text&quot;) != null) {</span>
                                // Otherwise, if it is a text object, just display its text
<span class="nc" id="L601">                                dialogueBox.show();</span>
<span class="nc" id="L602">                                dialogueBox.setText((String) player.getClosestObject().get(&quot;text&quot;));</span>
                            }
                        }
<span class="nc" id="L605">                        return true;</span>
                    }
                }

                // If an option dialogue is open it should soak up all keypresses
<span class="nc bnc" id="L610" title="All 6 branches missed.">                if (dialogueBox.isVisible() &amp;&amp; dialogueBox.getSelectBox().isVisible() &amp;&amp; !escapeMenu.isVisible()) {</span>
                    // Up or down
<span class="nc bnc" id="L612" title="All 4 branches missed.">                    if (keycode == Input.Keys.W || keycode == Input.Keys.UP) {</span>
<span class="nc" id="L613">                        dialogueBox.getSelectBox().choiceUp();</span>
<span class="nc bnc" id="L614" title="All 4 branches missed.">                    } else if (keycode == Input.Keys.S || keycode == Input.Keys.DOWN) {</span>
<span class="nc" id="L615">                        dialogueBox.getSelectBox().choiceDown();</span>
                    }

<span class="nc" id="L618">                    return true;</span>

                }


<span class="nc" id="L623">                return false;</span>
            }
        };
    }


    /**
     * Sets the player's energy level and updates the onscreen bar
     *
     * @param energy An int between 0 and 100
     */
    public void setEnergy(int energy) {
<span class="nc" id="L635">        this.energy = energy;</span>
<span class="nc bnc" id="L636" title="All 2 branches missed.">        if (this.energy &gt; 100) {</span>
<span class="nc" id="L637">            this.energy = 100;</span>
        }
<span class="nc" id="L639">        energyBar.setScaleY(this.energy / 100f);</span>
<span class="nc" id="L640">    }</span>

    /**
     * @return The player's energy out of 100
     */
    public int getEnergy() {
<span class="nc" id="L646">        return this.energy;</span>
    }

    /**
     * Decreases the player's energy by a certain amount
     *
     * @param energy The energy to decrement
     */
    public void decreaseEnergy(int energy) {
<span class="nc" id="L655">        this.energy = this.energy - energy;</span>
<span class="nc bnc" id="L656" title="All 2 branches missed.">        if (this.energy &lt; 0) {</span>
<span class="nc" id="L657">            this.energy = 0;</span>
        }
<span class="nc" id="L659">        energyBar.setScaleY(this.energy / 100f);</span>
<span class="nc" id="L660">    }</span>

    // Functions related to game score and requirements

    /**
     * Adds an amount of hours studied to the total hours studied
     * @param hours The amount of hours to add
     */
    public void addStudyHours(int hours) {
<span class="nc" id="L669">        hoursStudied += hours;</span>
<span class="nc" id="L670">    }</span>

    /**
     *
     * @return catchup_used boolean for if catchup has been used
     */
    public static boolean useCatchup(boolean catchup_used) {
<span class="nc bnc" id="L677" title="All 2 branches missed.">        if (!catchup_used){</span>
<span class="nc" id="L678">            catchup_used = true;</span>
        }
<span class="nc" id="L680">        return catchup_used;</span>
    }

    /**
     * Adds an amount of recreational hours to the total amount for the current day
     * @param hours The amount of hours to add
     */
    public void addRecreationalHours(int hours) {
<span class="nc" id="L688">        hoursRecreational += hours;</span>
<span class="nc" id="L689">    }</span>

    /**
     * @return Returns 'breakfast', 'lunch' or 'dinner' depending on the time of day
     */
    public String getMeal() {
<span class="nc" id="L695">        int hours = Math.floorDiv((int) daySeconds, 60);</span>
<span class="nc bnc" id="L696" title="All 4 branches missed.">        if (hours &gt;= 7 &amp;&amp; hours &lt;= 10) {</span>
            //Breakfast between 7:00-10:59am
<span class="nc" id="L698">            return &quot;breakfast&quot;;</span>
<span class="nc bnc" id="L699" title="All 4 branches missed.">        } else if (hours &gt; 10 &amp;&amp; hours &lt;= 16) {</span>
            // Lunch between 10:00am and 4:59pm
<span class="nc" id="L701">            return &quot;lunch&quot;;</span>
<span class="nc bnc" id="L702" title="All 4 branches missed.">        } else if (hours &gt; 16 &amp;&amp; hours &lt;= 21) {</span>
            // Dinner served between 4:00pm and 9:59pm
<span class="nc" id="L704">            return &quot;dinner&quot;;</span>
        } else {
            // Nothing is served between 10:00pm and 6:59am
<span class="nc" id="L707">            return &quot;food&quot;;</span>
        }
    }

    /**
     * @return A wake up message based on the time left until the exam
     */
    public String getWakeUpMessage() {
<span class="nc" id="L715">        int daysLeft = 8 - day;</span>
<span class="nc bnc" id="L716" title="All 2 branches missed.">        if (daysLeft != 1) {</span>
<span class="nc" id="L717">            return String.format(&quot;You have %d days left until your exam!\nRemember to eat, study and have fun, but don't overwork yourself!&quot;, daysLeft);</span>
        } else {
<span class="nc" id="L719">            return &quot;Your exam is tomorrow! I hope you've been studying! Remember not to overwork yourself and get enough sleep!&quot;;</span>
        }
    }


    /**
     * @param sleeping Sets the value of sleeping
     */
    public void setSleeping(boolean sleeping) {
<span class="nc" id="L728">        this.sleeping = sleeping;</span>
<span class="nc" id="L729">    }</span>

    /**
     * @return true if the player is sleeping
     */
    public boolean getSleeping() {
<span class="nc" id="L735">        return sleeping;</span>
    }

    /**
     * @param hours Add this amount of hours to the total hours slept
     */
    public void addSleptHours(int hours) {
<span class="nc" id="L742">        hoursSlept += hours;</span>
<span class="nc" id="L743">    }</span>

    /**
     * @return The number of seconds elapsed in the day
     */
    public float getSeconds() {
<span class="nc" id="L749">        return daySeconds;</span>
    }

    /**
     * Ends the game, called at the end of the 7th day, switches to a screen that displays a score
     */
    public void GameOver() {
<span class="nc" id="L756">        game.setScreen(new GameOverScreen(game, hoursStudied, hoursRecreational, hoursSlept));</span>
<span class="nc" id="L757">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.9.202303310957</span></div></body></html>